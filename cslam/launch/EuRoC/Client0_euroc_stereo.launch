<?xml version="1.0"?>
<launch>

  <arg name="dist" default="0"/>
  <arg name="cam" default="$(find ccmslam)/conf/euroc.yaml"/>
  <arg name="camera_calibration_file_path" default = "$(find ccmslam)/conf/euroc_camchain.yaml"/>

  <group ns="ccmslam">

    <node pkg="tf" type="static_transform_publisher" name="linkC0_broadcaster" args="-100 300 5 -1.571 0 -2 world odomC0 100" />

    <node pkg="ccmslam" type="ccmslamClientNode" name="ccmslamClientNode0" args="$(find ccmslam)/conf/ORBvoc.txt $(arg cam)" output="screen">

      <!-- ++++++++++++++++++++++++++++++++++++++++++++++ -->
      <!-- Agent Specific Params - !!!MUST BE ADJUSTED!!! -->

      <param name="~FrameId" type="string" value="odomC0" />
      <param name="~ClientId" type="int" value="0" />

      <param name="do_rectify" value="false"/>
      <param name="~TopicNameCamSub" type="string" value="/rect/first/image" />
      <param name="~RightTopicName" type="string" value="/rect/second/image" />

      <param name="~MapInTopicName" type="string" value="MapOutServer0" unless="$(arg dist)" />
      <param name="~MapInTopicName" type="string" value="MapOutServer0Disturbed" if="$(arg dist)" />

      <param name="server_mode" value="false"/>
    </node>

  </group>

  <!-- Stereo image rectification. -->
  <node name="stereo_undistort" pkg="image_undistort" type="stereo_undistort_node">

    <param name="input_camera_info_from_ros_params" value = "true"/>
    <param name="first_camera_namespace" value="cam0"/>
    <param name="second_camera_namespace" value="cam1"/>
    <param name="scale" value="1.0"/>
    <param name="process_every_nth_frame" value="1"/>

    <rosparam file="$(arg camera_calibration_file_path)"/>

    <remap from="raw/first/image" to="/cam0/image_raw"/>
    <remap from="raw/second/image" to="/cam1/image_raw"/>

  </node>

</launch>
