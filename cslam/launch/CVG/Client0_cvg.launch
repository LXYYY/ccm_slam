<?xml version="1.0"?>
<launch>
  <param name="use_sim_time" value="true"/>
  <arg name="sensor" default="xtion"/>
  <node pkg="image_transport" type="republish" name="republish_color" args="compressed in:=/kinect2/qhd/image_color_rect raw out:=/kinect2/qhd/image_color_rect"/>
  <node pkg="image_transport" type="republish" name="republish_depth" args="compressed in:=/kinect2/qhd/image_depth_rect raw out:=/kinect2/qhd/image_depth_rect"/>
  <arg name="dist" default="0"/>
  <arg name="cam" default="$(find ccmslam)/conf/caminfo_$(arg sensor)_cvg.yaml"/>

  <arg if="$(eval sensor == 'xtion')" name="rgb_topic" default="/camera/rgb/image_rect_color"/>
  <arg if="$(eval sensor == 'kinect')" name="rgb_topic" default="/kinect2/qhd/image_color_rect"/>
  <arg if="$(eval sensor == 'xtion')" name="depth_topic" default="/camera/depth_registered/sw_registered/image_rect"/>
  <arg if="$(eval sensor == 'kinect')" name="depth_topic" default="/kinect2/qhd/image_depth_rect"/>

  <group ns="ccmslam">

    <node pkg="tf" type="static_transform_publisher" name="linkC0_broadcaster" args="-100 300 5 -1.571 0 -2 world odomC0 100" />

    <arg name="debug_client" default="false" />
    <arg unless="$(arg debug_client)" name="launch_prefix_client" value=" " />
    <arg if="$(arg debug_client)" name="launch_prefix_client" value="xterm -e gdb --args" />

    <node pkg="ccmslam" type="ccmslamClientNode" name="ccmslamClientNode0" args="$(find ccmslam)/conf/ORBvoc.txt $(arg cam)" output="screen" launch-prefix="$(arg launch_prefix_client)">

      <!-- ++++++++++++++++++++++++++++++++++++++++++++++ -->
      <!-- Agent Specific Params - !!!MUST BE ADJUSTED!!! -->

      <param name="~Sensor" type="string" value="RGBD" />
      <param name="~FrameId" type="string" value="odomC0" />
      <param name="~ClientId" type="int" value="0" />

      <param name="~map_frame_id" type="string" value="map_0" />
      <param name="~camera_frame_id" type="string" value="robot_base_0" />
      <param name="~TopicNameCamSub" type="string" value="$(arg rgb_topic)" />
      <param name="~DepthTopicName" type="string" value="$(arg depth_topic)" />

      <param name="~MapInTopicName" type="string" value="MapOutServer0" unless="$(arg dist)" />
      <param name="~MapInTopicName" type="string" value="MapOutServer0Disturbed" if="$(arg dist)" />

    </node>

  </group>

  <arg if="$(eval sensor == 'xtion')" name="rosbag_path" default="/home/lxy/Datasets/eai-xtion-lab_2020-10-21-10-51-48.bag"/>
  <arg if="$(eval sensor == 'kinect')" name="rosbag_path" default="/home/lxy/Datasets/eai-kinect-lab-short_2020-09-09-15-23-31.bag"/>

  <arg name="rosbag_skip_first_n_sec" default="0" doc="Skip the first n seconds of the rosbag." />
  <node name="player" pkg="rosbag" type="play" output="screen" args="-r 1.0 -q -s $(arg rosbag_skip_first_n_sec) --clock $(arg rosbag_path)" />

</launch>

